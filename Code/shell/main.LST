C51 COMPILER V9.01   MAIN                                                                  10/07/2018 09:08:13 PAGE 1   


C51 COMPILER V9.01, COMPILATION OF MODULE MAIN
OBJECT MODULE PLACED IN main.OBJ
COMPILER INVOKED BY: C:\Tool\KeilC_8051\C51\BIN\C51.EXE main.c OMF2 BROWSE DEBUG

line level    source

   1          #include <REGX51.H>
   2          #include <stdlib.h>
   3          #include <string.h>
   4          
   5          
   6          #define BUFFER_SIZE             50
   7          #define DELIMITED               "_ "
   8          #define NUM_CLI                 2
   9          volatile unsigned long tick = 0;
  10          volatile char _data = 0;
  11          
  12          static char buffer[BUFFER_SIZE] = "";
  13          static unsigned char write_index = 0;
  14          static unsigned char read_index = 0;
  15          
  16          
  17          void uart_send_str(char* str);
  18          
  19          /*********************************  GPIO  **************************************/
  20          void led_on(unsigned char led_pin)
  21          {
  22   1              switch(led_pin)
  23   1              {
  24   2                      case 0:
  25   2                              P1_0 = 1;
  26   2                              break;
  27   2                      case 1:
  28   2                              P1_1 = 1;
  29   2                              break;
  30   2                      case 2:
  31   2                              P1_2 = 1;
  32   2                              break;
  33   2                      case 3:
  34   2                              P1_3 = 1;
  35   2                              break;
  36   2                      case 4:
  37   2                              P1_4 = 1;
  38   2                              break;
  39   2                      case 5:
  40   2                              P1_5 = 1;
  41   2                              break;
  42   2                      case 6:
  43   2                              P1_6 = 1;
  44   2                              break;
  45   2                      case 7:
  46   2                              P1_7 = 1;
  47   2                              break;          
  48   2              }
  49   1      }
  50          void led_off(unsigned char led_pin)
  51          {
  52   1              switch(led_pin)
  53   1              {
  54   2                      case 0:
  55   2                              P1_0 = 0;
C51 COMPILER V9.01   MAIN                                                                  10/07/2018 09:08:13 PAGE 2   

  56   2                              break;
  57   2                      case 1:
  58   2                              P1_1 = 0;
  59   2                              break;
  60   2                      case 2:
  61   2                              P1_2 = 1;
  62   2                              break;
  63   2                      case 3:
  64   2                              P1_3 = 0;
  65   2                              break;
  66   2                      case 4:
  67   2                              P1_4 = 0;
  68   2                              break;
  69   2                      case 5:
  70   2                              P1_5 = 0;
  71   2                              break;
  72   2                      case 6:
  73   2                              P1_6 = 0;
  74   2                              break;
  75   2                      case 7:
  76   2                              P1_7 = 0;
  77   2                              break;          
  78   2              }
  79   1      }
  80          void led_callback(unsigned char* argc,unsigned char** argv)
  81          {
  82   1      //  unsigned char led_id = argv[0][0] - '0';
  83   1      //  if(!strcmp("on",(const char*)argv[1]))
  84   1      //  {
  85   1      //      led_on(led_id);
  86   1      //  }else{
  87   1      //      led_off(led_id);
  88   1      //  }
  89   1      }
*** WARNING C280 IN LINE 80 OF MAIN.C: 'argc': unreferenced local variable
*** WARNING C280 IN LINE 80 OF MAIN.C: 'argv': unreferenced local variable
  90          void test_callback(char* argc,char** argv)
  91          {
  92   1              uart_send_str("\nTest function callback!\n");
  93   1      }
*** WARNING C280 IN LINE 90 OF MAIN.C: 'argc': unreferenced local variable
*** WARNING C280 IN LINE 90 OF MAIN.C: 'argv': unreferenced local variable
  94          /*****************************************************************/
  95          /*************************** CLI ********************************/
  96          /***************************************************************/
  97          typedef struct _cli_t_
  98          {
  99                  const char* cmd;        /* name of command */
 100                  unsigned int num_parameter;
 101                  const void (*callback)(unsigned char* argc,unsigned char** argv);
 102                  struct _cli_t_ *next_cmd;
 103          }cli_t;
 104          
 105          static cli_t* head_cmd = NULL ;
 106          
 107          cli_t list_cmd[NUM_CLI] =
 108          {
 109                  {
 110                          "led", /* name of cmd */
 111                          2, /* num_input_par */
 112                          led_callback,
 113                          NULL
C51 COMPILER V9.01   MAIN                                                                  10/07/2018 09:08:13 PAGE 3   

 114                  },
 115                  {
 116                          "test",
 117                          0,
 118                          test_callback,
 119                          NULL
 120                  }
 121          }
 122          /* 
 123           * function : parse_cli
 124           * parameter :  function take 2 parameter, 
 125           *                              unsigned char* buffer, that is string command of user trasmit through Terminal 
 126           *                              unsigned char len_buffer, lengh of command
 127           * brief : *function is not written finish*
 128          */
 129          void parse_cli(unsigned char* buffer, unsigned char len_buffer)
*** ERROR C141 IN LINE 129 OF MAIN.C: syntax error near 'void'
 130          {
*** ERROR C141 IN LINE 130 OF MAIN.C: syntax error near '{'
 131                  cli_t* temp_cmd;
 132                  unsigned char* _cmd = NULL;
 133                  unsigned char num_input = 0;
 134          }
*** ERROR C141 IN LINE 134 OF MAIN.C: syntax error near '}'
 135          /* 
 136           * function : prepare_cli
 137           * parameter : char rx_data that is data is received from RX uart
 138           * return : function return 1 if rx_data is enter (ascii == 13), else return 0
 139           * brief :       
 140          */
 141          char prepare_cli(char rx_data)
 142          {
 143   1              char result = 0;
 144   1              if(rx_data == 13)
 145   1              {
 146   2                      /* Command Process*/
 147   2                      //parse_cli(buffer,write_index);
 148   2                      write_index = 0;
 149   2                      memset(buffer,0,BUFFER_SIZE);
 150   2                      result = 1;
 151   2              }
 152   1              else if(rx_data == 8)
 153   1              {
 154   2                      write_index-- ;
 155   2                      buffer[write_index] = 0;
 156   2              }
 157   1              else{
 158   2                      buffer[write_index] = rx_data;
 159   2                      write_index++ ;
 160   2              }
 161   1      
 162   1              return result;  
 163   1      }
 164          
 165          /****************** TIMER ******************************/
 166          void timer0_init()         // 1ms
 167          {
 168   1              TMOD &= ~0x0F;
 169   1              TMOD |= 0x01; // 16 bit
 170   1      
 171   1              TH0 = 0xFC;
 172   1              TL0 = 0x67;
C51 COMPILER V9.01   MAIN                                                                  10/07/2018 09:08:13 PAGE 4   

 173   1      
 174   1              IE = 0x82;   // enable timer0 interrupt
 175   1              
 176   1              TR0 = 1;
 177   1      }
 178          /****************** delay function ******************************/
 179          void delay(unsigned long time)
 180          {
 181   1              unsigned long current_tick = tick;
 182   1              while(!(tick - current_tick == time));
 183   1      }
 184          /****************** UART ******************************/
 185          void uart_init()
 186          {
 187   1              TMOD = 0x20;     // timer1 mode 2 auto update
 188   1              SCON = 0x50;    // uart 8bit baudrate is selected by timer1
 189   1              TH1 = 0xFD; //9600      
 190   1              IE = 0x90;    // enable interrupt uart 
 191   1              TR1 = 1;
 192   1      }
 193          /* UART send 1 byte */
 194          void uart_send_byte(char data_)
 195          {
 196   1              SBUF = data_;
 197   1              while(TI ==0){}
 198   1              TI = 0;
 199   1      
 200   1      }
 201          /* UART send string */
 202          void uart_send_str(char* str)
 203          {
 204   1              while(*str)
 205   1              {
 206   2                      uart_send_byte(*str);
 207   2                      str++;  
 208   2              }
 209   1      }
 210          
 211          /********************************************************************************/
 212          /****************************    MAIN   ****************************************/
 213          /******************************************************************************/
 214          void main()
 215          {
 216   1              timer0_init();
 217   1              uart_init();
 218   1              P1 = 0x00;
 219   1      
 220   1      
 221   1              while(1)
 222   1              {               
 223   2                      if(_data != 0)
 224   2                      {
 225   3                              if(prepare_cli(_data))
 226   3                              {
 227   4                                      uart_send_str("\n\r");
 228   4                              }       
 229   3                              _data = 0;
 230   3                      }
 231   2              }                               
 232   1      }
 233          /****************** INTERRUPT  ******************************/
 234          void timer0_ISR(void) interrupt 1
C51 COMPILER V9.01   MAIN                                                                  10/07/2018 09:08:13 PAGE 5   

 235          {
 236   1               tick++;
 237   1               TH0 = 0xFC;
 238   1               TL0 = 0x66;
 239   1      }
 240          
 241          void uart_ISR(void) interrupt 4
 242          {
 243   1              if(RI == 1)
 244   1              {
 245   2                      _data = SBUF;
 246   2                      uart_send_byte(_data);
 247   2                      RI = 0;
 248   2              }
 249   1      }

C51 COMPILATION COMPLETE.  4 WARNING(S),  3 ERROR(S)
